{"ast":null,"code":"import React,{useEffect,useState}from'react';import{useParams,useNavigate}from'react-router-dom';import Navbar from'../ui/Navbar';import MemberInfo from'../list/MemberInfo';import RegiMovieList from'../list/RegiMovieList';import UpcomingMovies from'../list/UpcomingMovies';import axios from'axios';import'../styles/MyPage.css';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const MyPage=()=>{var _memberData$reviewInf;const{userId}=useParams();// URL에서 userId 가져오기\nconst[memberData,setMemberData]=useState(null);const[loading,setLoading]=useState(true);const[error,setError]=useState(null);const navigate=useNavigate();useEffect(()=>{const token=localStorage.getItem('token');// 토큰 유효성 확인\nconst validateToken=()=>{if(!token){alert('로그인이 필요합니다. 로그인 페이지로 이동합니다.');navigate('/');return false;}const parts=token.split('.');if(parts.length!==3){alert('유효하지 않은 토큰입니다. 다시 로그인해주세요.');localStorage.removeItem('token');navigate('/');return false;}return true;};if(!validateToken())return;const fetchData=async()=>{try{const response=await axios.get(\"/member/user/\".concat(userId),{headers:{Authorization:\"Bearer \".concat(token)}});setMemberData(response.data);}catch(err){var _err$response,_err$response$data;console.error('데이터를 불러오는 중 문제가 발생했습니다:',err);setError(((_err$response=err.response)===null||_err$response===void 0?void 0:(_err$response$data=_err$response.data)===null||_err$response$data===void 0?void 0:_err$response$data.message)||'데이터를 불러오는 중 문제가 발생했습니다.');}finally{setLoading(false);}};fetchData();},[userId,navigate]);if(loading)return/*#__PURE__*/_jsx(\"div\",{children:\"\\uB85C\\uB529 \\uC911...\"});if(error)return/*#__PURE__*/_jsx(\"div\",{children:error});// 탈퇴 처리 함수\nconst handleWithdraw=async()=>{try{const token=localStorage.getItem('token');if(!token)throw new Error('Token is missing or invalid.');await axios.put(\"/member/withdraw/\".concat(userId),{},{headers:{Authorization:\"Bearer \".concat(token)}});alert('탈퇴가 완료되었습니다.');localStorage.removeItem('token');navigate('/');// 로그인 페이지로 이동\n}catch(err){console.error('탈퇴 중 문제가 발생했습니다:',err);alert('탈퇴 중 오류가 발생했습니다. 다시 시도해주세요.');}};// 로그아웃 처리 함수\nconst handleLogout=async()=>{try{const token=localStorage.getItem('token');if(!token)throw new Error('Token is missing or invalid.');await axios.post('/member/logout',{},{headers:{Authorization:\"Bearer \".concat(token)}});alert('로그아웃되었습니다.');localStorage.removeItem('token');navigate('/');// 로그인 페이지로 이동\n}catch(err){console.error('로그아웃 중 문제가 발생했습니다:',err);alert('로그아웃 중 오류가 발생했습니다. 다시 시도해주세요.');}};return/*#__PURE__*/_jsxs(\"div\",{className:\"my-page\",children:[/*#__PURE__*/_jsx(Navbar,{}),/*#__PURE__*/_jsxs(\"div\",{className:\"content-wrapper\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"top-section\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"member-info-section\",children:/*#__PURE__*/_jsx(MemberInfo,{member:memberData===null||memberData===void 0?void 0:memberData.member,survey:memberData===null||memberData===void 0?void 0:memberData.survey,preferredGenres:memberData===null||memberData===void 0?void 0:memberData.preferredGenres,preferredActors:memberData===null||memberData===void 0?void 0:memberData.preferredActors})}),/*#__PURE__*/_jsx(\"div\",{className:\"upcoming-movies-container\",children:/*#__PURE__*/_jsx(UpcomingMovies,{})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"registered-movies-section\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"\\uB0B4\\uAC00 \\uB4F1\\uB85D\\uD55C \\uC601\\uD654\"}),(memberData===null||memberData===void 0?void 0:(_memberData$reviewInf=memberData.reviewInfos)===null||_memberData$reviewInf===void 0?void 0:_memberData$reviewInf.length)===0?/*#__PURE__*/_jsx(\"p\",{children:\"\\uB4F1\\uB85D\\uB41C \\uC601\\uD654\\uAC00 \\uC5C6\\uC2B5\\uB2C8\\uB2E4.\"}):/*#__PURE__*/_jsx(RegiMovieList,{movies:memberData.reviewInfos})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"account-actions\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"account-button logout-button\",onClick:handleLogout,children:\"\\uB85C\\uADF8\\uC544\\uC6C3\"}),/*#__PURE__*/_jsx(\"button\",{className:\"account-button withdraw-button\",onClick:handleWithdraw,children:\"\\uD68C\\uC6D0 \\uD0C8\\uD1F4\"})]})]})]});};export default MyPage;","map":{"version":3,"names":["React","useEffect","useState","useParams","useNavigate","Navbar","MemberInfo","RegiMovieList","UpcomingMovies","axios","jsx","_jsx","jsxs","_jsxs","MyPage","_memberData$reviewInf","userId","memberData","setMemberData","loading","setLoading","error","setError","navigate","token","localStorage","getItem","validateToken","alert","parts","split","length","removeItem","fetchData","response","get","concat","headers","Authorization","data","err","_err$response","_err$response$data","console","message","children","handleWithdraw","Error","put","handleLogout","post","className","member","survey","preferredGenres","preferredActors","reviewInfos","movies","onClick"],"sources":["C:/Users/MovieRecommendations/frontend/src/components/page/MyPage.jsx"],"sourcesContent":["import React, { useEffect, useState } from 'react';\r\nimport { useParams, useNavigate } from 'react-router-dom';\r\nimport Navbar from '../ui/Navbar';\r\nimport MemberInfo from '../list/MemberInfo';\r\nimport RegiMovieList from '../list/RegiMovieList';\r\nimport UpcomingMovies from '../list/UpcomingMovies';\r\nimport axios from 'axios';\r\nimport '../styles/MyPage.css';\r\n\r\nconst MyPage = () => {\r\n  const { userId } = useParams(); // URL에서 userId 가져오기\r\n  const [memberData, setMemberData] = useState(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState(null);\r\n  const navigate = useNavigate();\r\n\r\n  useEffect(() => {\r\n    const token = localStorage.getItem('token');\r\n\r\n    // 토큰 유효성 확인\r\n    const validateToken = () => {\r\n      if (!token) {\r\n        alert('로그인이 필요합니다. 로그인 페이지로 이동합니다.');\r\n        navigate('/');\r\n        return false;\r\n      }\r\n\r\n      const parts = token.split('.');\r\n      if (parts.length !== 3) {\r\n        alert('유효하지 않은 토큰입니다. 다시 로그인해주세요.');\r\n        localStorage.removeItem('token');\r\n        navigate('/');\r\n        return false;\r\n      }\r\n      return true;\r\n    };\r\n\r\n    if (!validateToken()) return;\r\n\r\n    const fetchData = async () => {\r\n      try {\r\n        const response = await axios.get(`/member/user/${userId}`, {\r\n          headers: { Authorization: `Bearer ${token}` },\r\n        });\r\n\r\n        setMemberData(response.data);\r\n      } catch (err) {\r\n        console.error('데이터를 불러오는 중 문제가 발생했습니다:', err);\r\n        setError(\r\n          err.response?.data?.message || '데이터를 불러오는 중 문제가 발생했습니다.'\r\n        );\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n\r\n    fetchData();\r\n  }, [userId, navigate]);\r\n\r\n  if (loading) return <div>로딩 중...</div>;\r\n  if (error) return <div>{error}</div>;\r\n\r\n  // 탈퇴 처리 함수\r\n  const handleWithdraw = async () => {\r\n    try {\r\n      const token = localStorage.getItem('token');\r\n      if (!token) throw new Error('Token is missing or invalid.');\r\n\r\n      await axios.put(\r\n        `/member/withdraw/${userId}`,\r\n        {},\r\n        {\r\n          headers: { Authorization: `Bearer ${token}` },\r\n        }\r\n      );\r\n      alert('탈퇴가 완료되었습니다.');\r\n      localStorage.removeItem('token');\r\n      navigate('/'); // 로그인 페이지로 이동\r\n    } catch (err) {\r\n      console.error('탈퇴 중 문제가 발생했습니다:', err);\r\n      alert('탈퇴 중 오류가 발생했습니다. 다시 시도해주세요.');\r\n    }\r\n  };\r\n\r\n  // 로그아웃 처리 함수\r\n  const handleLogout = async () => {\r\n    try {\r\n      const token = localStorage.getItem('token');\r\n      if (!token) throw new Error('Token is missing or invalid.');\r\n\r\n      await axios.post(\r\n        '/member/logout',\r\n        {},\r\n        {\r\n          headers: { Authorization: `Bearer ${token}` },\r\n        }\r\n      );\r\n      alert('로그아웃되었습니다.');\r\n      localStorage.removeItem('token');\r\n      navigate('/'); // 로그인 페이지로 이동\r\n    } catch (err) {\r\n      console.error('로그아웃 중 문제가 발생했습니다:', err);\r\n      alert('로그아웃 중 오류가 발생했습니다. 다시 시도해주세요.');\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"my-page\">\r\n      <Navbar />\r\n      <div className=\"content-wrapper\">\r\n        <div className=\"top-section\">\r\n          <div className=\"member-info-section\">\r\n            <MemberInfo\r\n              member={memberData?.member}\r\n              survey={memberData?.survey}\r\n              preferredGenres={memberData?.preferredGenres}\r\n              preferredActors={memberData?.preferredActors}\r\n            />\r\n          </div>\r\n          <div className=\"upcoming-movies-container\">\r\n            <UpcomingMovies />\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"registered-movies-section\">\r\n          <h2>내가 등록한 영화</h2>\r\n          {memberData?.reviewInfos?.length === 0 ? (\r\n            <p>등록된 영화가 없습니다.</p>\r\n          ) : (\r\n            <RegiMovieList movies={memberData.reviewInfos} />\r\n          )}\r\n        </div>\r\n\r\n        {/* 탈퇴와 로그아웃 버튼 */}\r\n        <div className=\"account-actions\">\r\n          <button className=\"account-button logout-button\" onClick={handleLogout}>\r\n            로그아웃\r\n          </button>\r\n          <button className=\"account-button withdraw-button\" onClick={handleWithdraw}>\r\n            회원 탈퇴\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default MyPage;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}